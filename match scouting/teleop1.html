<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Title</title>
    <!-- You can link CSS files here -->
    <link rel="stylesheet" href="../stylesheet.css">

</head>
<body style="background-color:#00eeff;">
    <!-- This is the visible content of the page -->

    <div class="fixedElement">
      <a href = "auton.html">
      <img src="../images/Auto-Button.png">
      </a>
      <a href = "teleop1.html">
      <img src="../images/Tele-button.png">
      </a>
      <a href = "teleop2.html">
      <img src="../images/Tele-button.png">
      </a>
      <a href = "teleop3.html">
      <img src="../images/Tele-button.png">
      </a>
      <a href = "teleop4.html">
      <img src="../images/Tele-button.png">
      </a>
      <a href = "endgame.html">
      <img src="../images/Endgame-Button.png">
      </a>
    </div>


    <h1>Teleop</h1>
    <p>3322 Rebuilt Scouting</p>
    <br>
  <div class="section">
    <h2>Teleop</h2>

    <!-- L4 -->
          <div class="buttons">
        <div id="l4-button-success" class="successButton">
          <button style="width: 100%; height: 200px; font-size:30px;" id="scoring" class="incButton">Scoring time: 0.00</button>
        </div>
        <div id="l4-button-failure" class="failureButton">
          <button style="width: 100%; height: 200px; font-size:30px;" onclick="updateCrateData(4, 0, 1)" id="passing" class="incButton">passing time: 0.00</button>
        </div>
      </div>

        <script>

      let timerInterval = null;
  let startTime = 0;
  let elapsed = 0;

  
    let breakdownTotal = 0;
    let breakdownInterval;
    let isBroken = false;
    let starting = 0;


    const dataList = [
      "teamNumber,scouterName,matchNumber,mobility,ballsShotOver,Crates Pushed,L1S,L1F,L2S,L2F,L3S,L3F,L4S,L4F"]

    //l1 success, l1 fail, l2 success, l2 fail, l3 success, l3 fail, l4 success, l4 fail
    const crateData = [["L1 Success: ",
      "L1 Failure: ",
      "L2 Success: ",
      "L2 Failure: ",
      "L3 Success: ",
      "L3 Failure: ",
      "L4 Success: ",
      "L4 Failure: ", 
      "Bucket Success",
      "Bucket Failure"],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    []]



    function breakdownToggle() {
      if (isBroken == false) {
        starting = Date.now(); // Use global variable
        isBroken = true;
        document.getElementById("breakdown").style.backgroundColor = "yellow";


        breakdownInterval = setInterval(() => {
          document.getElementById("breakdown").textContent = (((Date.now() - starting)+ breakdownTotal) / 1000 ).toFixed(2);
        }, 100);
      }
      else {
        document.getElementById("breakdown").style.backgroundColor = "LightGray";
        isBroken = false;
        //alert(Date.now() - starting);
        clearInterval(breakdownInterval);
        let elapsed = ((Date.now() - starting));
        breakdownTotal += elapsed;
        document.getElementById("breakdown").textContent = (breakdownTotal/1000).toFixed(2);



      }
      //let starting = (now.getMinutes() + "." + now.getSeconds() + now.getMilliseconds()); 

    }

    function submit() {
      // Gather all data

      //datalist.push(document.getElementById("matchNumber").value + "");
      data = document.getElementById("teamNumber").value + "," +
        document.getElementById("scouterName").value + "," +
        document.getElementById("matchNumber").value + "," +
        (document.getElementById("mobility").checked ? "1" : "0") + "," +
        document.getElementById("ballsShotOver").value + "," +
        document.getElementById("cratesPushed").value + "," +
        crateData[1][0] + "," +
        crateData[1][1] + "," +
        crateData[1][2] + "," +
        crateData[1][3] + "," +
        crateData[1][4] + "," +
        crateData[1][5] + "," +
        crateData[1][6] + "," +
        crateData[1][7] + "," +
        crateData[1][8] + "," +
        crateData[1][9] + "," +
        + breakdownTotal;


      dataList.push(data);


      document.getElementById("qrcode").innerHTML = "";

      // Generate QR code linking to the CSV data URL
      new QRCode(document.getElementById("qrcode"), {
        text: data,   // this is the file download link encoded in the QR
        width: 200,
        height: 200
      });

      window.location.href = "qrcode.html" + "?data=" + data;
    }

    function updateCrateData(level, success, change) {
      const index = (level * 2 - 1) - success;
      crateData[1][index] += change;

      const levelString = "L" + level;
      const successString = (success == 1) ? "Success" : "Failure";

      document.getElementById(levelString + successString + "Button").textContent = crateData[0][index] + "\n < " + crateData[1][index] + " >";

    }


      const scoring = document.getElementById("scoring");
      const passing = document.getElementById("passing");

      function startScoringTimer() {
          if (timerInterval) return; // Prevent multiple intervals
          startTime = Date.now() - elapsed;
          timerInterval = setInterval(() => {
              elapsed = Date.now() - startTime;
              scoring.textContent = "Scoring time: " + (elapsed / 1000).toFixed(2);
          }, 10);
      }
      function startpassingTimer() {
          if (timerInterval) return; // Prevent multiple intervals
          startTime = Date.now() - elapsed;
          timerInterval = setInterval(() => {
              elapsed = Date.now() - startTime;
              passing.textContent = "passing time: " + (elapsed / 1000).toFixed(2);
          }, 10);
      }

      // Stop counting when button is released
      function stopScoringTimer() {
          clearInterval(timerInterval);
          timerInterval = null;
      }
      function stoppassingTimer() {
          clearInterval(timerInterval);
          timerInterval = null;
      }

      // Mouse events
      scoring.addEventListener("mousedown", startScoringTimer);
      scoring.addEventListener("mouseup", stopScoringTimer);
      scoring.addEventListener("mouseleave", stopScoringTimer);

      passing.addEventListener("mousedown", startpassingTimer);
      passing.addEventListener("mouseup", stoppassingTimer);
      passing.addEventListener("mouseleave", stoppassingTimer);

  </script>


    <!-- You can link JavaScript files here -->
    <script src="MatchScouting.js"></script>
</body>
</html>

