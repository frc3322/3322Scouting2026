<!-- 
Documentation is very important for this project

For all of the interactive elements, here is their ID and what they do:

AUTON:
mobility - mobility
ballsShotOver - MCQ of how many balls were shot over
cratesPushed - The number of the crates pushed over the line in auto 

TELEOP: // Deleted L1-L4







bucketsSucceeded // These three haven't been added into the QR code yet.
bucketsFailed
methodOfBuckets - MCQ
breakdown - the breakdown

MATCH INFORMATION:
teamNumber - The team number
scouterName - The scouter's name
matchNubmer - The match number

increaseL1Button - Button to increase L1 button

MISC:
submit - The submit button



Todo:
Put the whole form into a form tag, and make it so that it clears when you submit the form.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3322 Rebuiltâ„¢ 2026 Scouting</title>
  <link rel="stylesheet" href="stylesheet.css">

</head>

<body>
  <div class="section">
    <h1>3322 Rebuilt 2026 Scouting</h1>
  </div>
  <br>
  <!-- auton -->
  <div class="section">
    <h2>Auton:</h2>
    <label for="mobility">Mobility:</label>
    <br>
    <input type="checkbox" id="mobility"><br>
    <br>
    
    <label for="autoclimb">Climb:</label>
    <br>
    <input type="checkbox" id="autoclimb"><br>
    <br>
    <div class="buttons">
      <div id="auto-button-success" class="successButton">
        <button onclick="updateCrateData(1, 1, 1)" id="AutoSuccess" class="incButton">Hub Success: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(1, 1, -1)" class="decButton">-1</button>
      </div>
      <div id="auto-button-failure" class="failureButton">
        <button onclick="updateCrateData(1, 0, 1)" id="L4FailureButton" class="incButton">Hub Failure: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(1, 0, -1)" class="decButton">-1</button>
      </div>
      
    </div>

  </div>

  <br>
  <div class="section">
    <h2>Teleop</h2>

    <!-- L4 -->
    <div class="buttons">
      <div id="hubsuccess" class="successButton">
        <button onclick="updateCrateData(4, 1, 1)" id="hubsuccess" class="incButton">Hub Success: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(4, 1, -1)" class="decButton">-1</button>
      </div>
      <div id="hubfailure" class="failureButton">
        <button onclick="updateCrateData(4, 0, 1)" id="hubfailure" class="incButton">Hub Failure: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(4, 0, -1)" class="decButton">-1</button>
      </div>
      
    </div>
    <br>
          <div class="buttons">
        <div id="l4-button-success" class="successButton">
          <button id="scoring" class="incButton">Scoring time: 0.00</button>
        </div>
        <div id="l4-button-failure" class="failureButton">
          <button onclick="updateCrateData(4, 0, 1)" id="shuttleing" class="incButton">Shuttleing time: 0.00</button>
        </div>
      </div>


    <select  id="Climb">
      <option value=L1>L1 Climb</option>
      <option value=L2>L2 Climb</option>
      <option value=L3>L3 Climb</option>
      <option value=Failure>Climb Failed :( </option>
    </select>
    <br>    <br>

      <label for="bump">Did they use Bump?</label>

      <input type="checkbox" id="bump"><br>

      <label for="trench">Did they use Trench?</label>

      <input type="checkbox" id="trench"><br>

  </div>
  



  <br>

  <div class="section">
    <h2>Match info:</h2>
    <input type="number"  id="teamNumber" placeholder="Team Number">
</select>
    <input type="text" id="scouterName" placeholder="Scouter Name">
    <input type="number" id="matchNumber" placeholder="Match Number">
    <br><br>
    <label for="breakdown">Breakdown:</label>
    <br>
    <button id="breakdown">0.00</button>
    <br><br>
    <button type="button" id="submit">Submit!</button>
    <div id="qrcode"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>

      let timerInterval = null;
  let startTime = 0;
  let elapsed = 0;


    let breakdownTotal = 0;
    let breakdownInterval;
    let isBroken = false;
    let starting = 0;


    const dataList = [
      "teamNumber,scouterName,matchNumber,mobility,ballsShotOver,Crates Pushed,L1S,L1F,L2S,L2F,L3S,L3F,L4S,L4F"]

    //l1 success, l1 fail, l2 success, l2 fail, l3 success, l3 fail, l4 success, l4 fail
    const crateData = [["L1 Success: ",
      "L1 Failure: ",
      "L2 Success: ",
      "L2 Failure: ",
      "L3 Success: ",
      "L3 Failure: ",
      "L4 Success: ",
      "L4 Failure: ", 
      "Bucket Success",
      "Bucket Failure"],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    []]



    function breakdownToggle() {
      if (isBroken == false) {
        starting = Date.now(); // Use global variable
        isBroken = true;
        document.getElementById("breakdown").style.backgroundColor = "yellow";


        breakdownInterval = setInterval(() => {
          document.getElementById("breakdown").textContent = (((Date.now() - starting)+ breakdownTotal) / 1000 ).toFixed(2);
        }, 100);
      }
      else {
        document.getElementById("breakdown").style.backgroundColor = "LightGray";
        isBroken = false;
        //alert(Date.now() - starting);
        clearInterval(breakdownInterval);
        let elapsed = ((Date.now() - starting));
        breakdownTotal += elapsed;
        document.getElementById("breakdown").textContent = (breakdownTotal/1000).toFixed(2);



      }
      //let starting = (now.getMinutes() + "." + now.getSeconds() + now.getMilliseconds()); 

    }

    function submit() {
      // Gather all data

      //datalist.push(document.getElementById("matchNumber").value + "");
      data = "Stone Cold joe thanks you for Scouting!";




      document.getElementById("qrcode").innerHTML = "";

      // Generate QR code linking to the CSV data URL
      new QRCode(document.getElementById("qrcode"), {
        text: data,   // this is the file download link encoded in the QR
        width: 200,
        height: 200
      });

      window.location.href = "qrcode.html" + "?data=" + data;
    }

    function updateCrateData(level, success, change) {
      const index = (level * 2 - 1) - success;
      crateData[1][index] += change;

      const levelString = "L" + level;
      const successString = (success == 1) ? "Success" : "Failure";

      document.getElementById(levelString + successString + "Button").textContent = crateData[0][index] + "\n < " + crateData[1][index] + " >";

    }

    document.getElementById("submit").addEventListener("click", submit);
    document.getElementById("breakdown").addEventListener("click", breakdownToggle);

      const scoring = document.getElementById("scoring");
      const shuttleing = document.getElementById("shuttleing");

      function startScoringTimer() {
          if (timerInterval) return; // Prevent multiple intervals
          startTime = Date.now() - elapsed;
          timerInterval = setInterval(() => {
              elapsed = Date.now() - startTime;
              scoring.textContent = "Scoring time: " + (elapsed / 1000).toFixed(2);
          }, 10);
      }
      function startShuttleingTimer() {
          if (timerInterval) return; // Prevent multiple intervals
          startTime = Date.now() - elapsed;
          timerInterval = setInterval(() => {
              elapsed = Date.now() - startTime;
              shuttleing.textContent = "Shuttleing time: " + (elapsed / 1000).toFixed(2);
          }, 10);
      }

      // Stop counting when button is released
      function stopScoringTimer() {
          clearInterval(timerInterval);
          timerInterval = null;
      }
      function stopShuttleingTimer() {
          clearInterval(timerInterval);
          timerInterval = null;
      }

      // Mouse events
      scoring.addEventListener("mousedown", startScoringTimer);
      scoring.addEventListener("mouseup", stopScoringTimer);
      scoring.addEventListener("mouseleave", stopScoringTimer);

      shuttleing.addEventListener("mousedown", startShuttleingTimer);
      shuttleing.addEventListener("mouseup", stopShuttleingTimer);
      shuttleing.addEventListener("mouseleave", stopShuttleingTimer);

  </script>
</body>

</html>
